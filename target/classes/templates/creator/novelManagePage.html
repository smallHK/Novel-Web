<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>小说管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="/bootstrap-4.3.1-dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/content.css" rel="stylesheet">
    <script src="/js/jquery-3.3.1.js"></script>
    <script src="/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-light bg-light sticky-top"><a class="navbar-brand" href="#">HK小说网</a></nav>
<ul class="nav justify-content-center nav-pills nav-fill mb-3">
    <li class="nav-item"><a class="nav-link active" href="#">小说管理</a></li>
    <li class="nav-item"><a class="nav-link" href="#">未开放小说</a></li>
    <li class="nav-item"><a class="nav-link" href="#">正在审核小说</a></li>
    <li class="nav-item"><a class="nav-link" href="#">已开放小说</a></li>
    <li class="nav-item"><a class="nav-link" href="/creator/createNovelPage">新建小说</a></li>
</ul>
<div id="content">
    <div class="row mb-3 mx-auto" style="width: 1200px;">
        <div class="col-sm-2">
            <div class="card">
                <div class="overflow-hidden"><img src="/imgs/novelCover.jpg" class="card-img-top book-cover-img" alt="..."></div>
                <div class="card-body">
                    <h5 class="card-text">虫之歌</h5>
                    <a href="#" class="btn btn-primary">编辑内容</a></div>
            </div>
        </div>
        <div class="col-sm-2">
            <div class="card">
                <div class="overflow-hidden"><img src="/imgs/novelCover.jpg" class="card-img-top book-cover-img"alt="..."></div>
                <div class="card-body">
                    <h5 class="card-text">虫之歌</h5>
                    <a href="#" class="btn btn-primary">编辑内容</a></div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        //当前用户的所有已创建小说
        $.get("/creator/listAllNovel", function (data) {
            if (data.status === 0) {
                var content = $("#content");
                content.empty();
                var novelList = data.novelList;
                var len = novelList.length;
                var lineCount = len % 6 === 0 ? len /6 : len/6 + 1;
                var index = 0;
                for(var i = 0; i < lineCount; i++) {
                    var rowEl = $("<div class=\"row mb-3 mx-auto\" style=\"width: 1200px;\"></div>");
                    content.append(rowEl);
                    for(var j = 0; j < 6; j++) {
                        if(index >= len) break;
                        var novel = novelList[index];
                        var colEl = $("<div class=\"col-sm-2\"></div>");
                        var card = $("<div class=\"card\"></div>");
                        colEl.append(card);

                        if(novel.coverImg !== null && novel.coverImg !== ""){
                            var cardImg = $("<div class=\"overflow-hidden\"><img src=\"" + novel.coverImg + "\"class=\"card-img-top book-cover-img\" alt=\"...\"></div>");
                            card.append(cardImg);
                        }else {
                            var cardImg = $("<div class=\"overflow-hidden\"><img src=\"/imgs/novelCover.jpg\" class=\"card-img-top book-cover-img\" alt=\"...\"></div>");
                            card.append(cardImg);
                        }

                        var cardBody = $("<div class=\"card-body\"></div>");
                        card.append(cardBody);
                        var novelTitle = $("<h5 class=\"card-text\"></h5>");
                        novelTitle.text(novel.novelName);
                        cardBody.append(novelTitle);
                        var editBtn = $("<a href=\"#\" class=\"btn btn-primary\">编辑内容</a></div>");
                        cardBody.append(editBtn);
                        rowEl.append(colEl);
                        index++;
                    }
                }
            }else {
                alert(data.msg);
                location.href = "/index";
            }
        })

    });


    //获取未开放小说
    $.get("/creator/listAllCreatedNovel", function (data) {
        if (data.status === 0) {
            var ul = $("#created_novel_list_ul");
            ul.empty();
            var novelList = data.novelList;
            for (var i = 0; i < novelList.length; i++) {
                var novel = novelList[i];
                var li = $("<li></li>");
                var a = $("<a></a>");
                a.attr("href", "/creator/applyForPublish/" + novel.id)
                var span = $("<span></span>").text(novel.novelName);
                ul.append(li.append(a.append(span)));
            }
        }
    })

    //获取正在审核小说
    $.get("/creator/listAllNoPublishedNovel", function (data) {
        if (data.status === 0) {
            var ul = $("#unpublished_novel_list_ul");
            ul.empty();
            var novelList = data.novelList;
            for (var i = 0; i < novelList.length; i++) {
                var novel = novelList[i];
                var li = $("<li></li>");
                var span = $("<span></span>").text(novel.novelName);
                ul.append(li.append(span));
            }
        }
    })

    //获取所有通过审核小说
    $.get("/creator/listAllPublishedNovel", function (data) {
        if (data.status === 0) {
            var ul = $("#published_novel_list_ul");
            var novelAndEditorList = data.info;
            var html = "";
            for (var i = 0; i < novelAndEditorList.length; i++) {
                var line = "<li><span>" + novelAndEditorList[i].novel.novelName
                    + "</span>&nbsp;&nbsp;编辑:<span><a href=\"#\">"
                    + novelAndEditorList[i].editor.editorName + "</a></span></li>";
                html += line;
            }
            ul.html(html);
        }
    })

</script>
</body>
</html>