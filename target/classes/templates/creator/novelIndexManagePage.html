<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title  th:text="${novelIndexInfo.novelName}">虫之歌</title>
    <script th:src="@{/js/jquery-3.3.1.js}" src="/js/jquery-3.3.1.js"></script>
    <link rel="stylesheet" href="/bootstrap-4.3.1-dist/css/bootstrap-reboot.min.css">
    <link rel="stylesheet" href="/bootstrap-4.3.1-dist/css/bootstrap.min.css">
    <script src="/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/css/content.css">
</head>
<body class="main-back">
<nav class="navbar navbar-light bg-dark sticky-top mb-3" > <a class="navbar-brand text-light" th:href="@{/creator/novelManagePage}" href="../index.html">HK小说网</a> </nav>

<!--添加新卷弹窗-->
<div class="modal fade" id="addNewVolume" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">添加新卷</h5>
            </div>
            <div class="modal-body">
                <form action="/creator/simplyAddNewVolume" method="post">
                    <div class="form-group">
                        <input type="hidden" name="novel-id" th:value="${novelIndexInfo.novelId}">
                        <input type="text" class="form-control" placeholder="新卷卷名" name="volume-name" required>
                    </div>
                    <input class="btn btn-primary" type="submit" value="确认" >
                </form>
            </div>
        </div>
    </div>
</div>
<!--修改章节内容-->
<div class="modal fade" id="updateChapter" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">修改章节内容</h5>
            </div>
            <div class="modal-body">
                <form action="/creator/simplyUpdateChapter" method="post">
                    <input type="hidden" name="chapter_id">
                    <div class="form-group">
                        <label>新章节名</label>
                        <input type="text" class="form-control" placeholder="新章节名称" name="chapter_title" required>
                    </div>
                    <div class="form-group">
                        <label>新章节内容</label>
                        <textarea class="form-control" placeholder="新章节内容" name="chapter_content" required></textarea>
                    </div>
                    <input class="btn btn-primary" type="submit" value="确认" >
                </form>
            </div>
        </div>
    </div>
</div>
<div class="c-w-80 mx-auto border shadow-lg p-3 rounded mb-5">
    <div class="border-bottom p-5">
        <h3 class="h3 text-align-center" th:text="${novelIndexInfo.novelName}">虫之歌</h3>
    </div>
    <div th:each="volumeInfo :${novelIndexInfo.volumeInfoList}"  class="container my-5" >
        <div>
            <h5 th:text="${volumeInfo.volumeTitle}"> 第零卷 </h5>
        </div>
        <div class="row my-3">
            <div th:each="chapter: ${volumeInfo.chapterList}" class="col-3 my-2"><button class="btn btn-light btn-block" th:onclick="updateChapter([[${chapter.id}]]);" title="" th:text="${chapter.title}">0.00 诗歌 The firs</button> </div>
            <div class="col-3 my-2"><a class="btn btn-light btn-block"  th:href="@{/creator/enterSimplyAddChapterPage/{novelId}/{volumeId}(novelId=${novelIndexInfo.novelId}, volumeId=${volumeInfo.volumeId})}" href="/creator/enterAddChapterPage" title="">+添加章节</a> </div>
        </div>
    </div>

    <div class="container my-5">
        <div><button class="btn btn-light btn-block" data-toggle="modal" data-target="#addNewVolume">+添加新卷</button> </div>
    </div>
</div>
<script>
    function updateChapter(chapterId) {
        $.get("/creator/rest/chapterInfo/" + chapterId, function (data) {
            if(data.status === 0) {
                var info = data.chapterInfo;
                var paraList = info.paragraphList;
                var content = "";
                for(var i  = 0; i< paraList.length; i++) {
                    if(i !== 0) content += "\n" + paraList[i].content;
                    else content += paraList[i].content;
                }

                var modal = $("#updateChapter");
                modal.find("form").find("input:eq(0)").val(info.id);
                modal.find("form").find("input:eq(1)").val(info.title);
                modal.find("form").find("textarea").text(content);
                modal.modal('toggle');


            }
        });
    }
</script>
</body>
</html>